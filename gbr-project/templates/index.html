<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f0f4f8; transition: background 0.3s; }
        .card { background: #fff; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .btn { background: linear-gradient(90deg,#4CAF50,#2e7d32); color:white; padding:0.7rem 1.5rem; border-radius:0.5rem; font-weight:600; transition: 0.3s; }
        .btn:hover { background: linear-gradient(90deg,#45a049,#1b5e20); }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

<div class="card w-full max-w-md">
    <h1 class="text-3xl font-bold text-center mb-6 text-green-600">üéì Student Performance Predictor</h1>

    <form id="predictForm" class="space-y-4">
        <!-- Study Hours -->
        <div>
            <label class="block mb-1 font-medium">üìö Study Hours: <span id="hrVal">5</span></label>
            <input type="range" name="hours" id="hours" min="0" max="15" value="5" class="w-full">
        </div>

        <!-- Previous Score -->
        <div>
            <label class="block mb-1 font-medium">üìä Previous Score (%): <span id="scoreVal">50</span></label>
            <input type="range" name="score" id="score" min="0" max="100" value="50" class="w-full">
        </div>

        <!-- Activities -->
        <div>
            <label class="block mb-1 font-medium">‚öΩ Extracurricular Activities:</label>
            <select name="activities" id="activities" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400">
                <option value="0">No</option>
                <option value="1">Yes</option>
            </select>
        </div>

        <!-- Sleep Hours -->
        <div>
            <label class="block mb-1 font-medium">üò¥ Sleep Hours: <span id="sleepVal">7</span></label>
            <input type="range" name="sleep" id="sleep" min="0" max="12" value="7" class="w-full">
        </div>

        <!-- Sample Papers Practiced -->
        <div>
            <label class="block mb-1 font-medium">üìù Sample Papers Practiced: <span id="questionsVal">5</span></label>
            <input type="range" name="questions" id="questions" min="0" max="50" value="5" class="w-full">
        </div>

        <div class="text-center">
            <button type="submit" class="btn">üöÄ Predict</button>
        </div>
    </form>

    <div id="result" class="mt-6 text-center p-4 bg-green-100 text-green-800 rounded-lg hidden animate-pulse">
        üåü Predicted Performance Score: <span id="predictionVal"></span>
    </div>

    <canvas id="chart" class="mt-6 hidden"></canvas>
</div>

<script>
    // Update slider values dynamically
    const hr = document.getElementById('hours');
    const score = document.getElementById('score');
    const sleep = document.getElementById('sleep');
    const questions = document.getElementById('questions');

    const hrVal = document.getElementById('hrVal');
    const scoreVal = document.getElementById('scoreVal');
    const sleepVal = document.getElementById('sleepVal');
    const questionsVal = document.getElementById('questionsVal');

    hr.oninput = () => hrVal.innerText = hr.value;
    score.oninput = () => scoreVal.innerText = score.value;
    sleep.oninput = () => sleepVal.innerText = sleep.value;
    questions.oninput = () => questionsVal.innerText = questions.value;

    // Declare chart instance globally
    let chartInstance = null;

    // AJAX form submit for real-time prediction
    document.getElementById('predictForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {
            hours: formData.get('hours'),
            score: formData.get('score'),
            activities: formData.get('activities'),
            sleep: formData.get('sleep'),
            questions: formData.get('questions')
        };

        const res = await fetch('/predict_ajax', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        const result = await res.json();

        // Update prediction text
        document.getElementById('predictionVal').innerText = result.prediction.toFixed(2);
        document.getElementById('result').classList.remove('hidden');

        // Get canvas context
        const ctx = document.getElementById('chart').getContext('2d');
        document.getElementById('chart').classList.remove('hidden');

        // ‚úÖ Destroy previous chart if exists
        if (chartInstance) {
            chartInstance.destroy();
        }

        // ‚úÖ Create new chart with updated prediction
        chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Predicted', 'Max Score'],
                datasets: [{
                    label: 'Performance',
                    data: [result.prediction, 100],
                    backgroundColor: ['#4CAF50', '#A0A0A0']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
    });
</script>

</body>
</html>
